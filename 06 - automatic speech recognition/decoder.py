import torch


class Decoder(torch.nn.Module):

    def __init__(self, labels, blank=0):
        super().__init__()
        self.labels = labels
        self.blank = blank

    def forward(self, emission: torch.Tensor) -> str:
        indices = torch.argmax(emission, dim=-1)
        indices = torch.unique_consecutive(indices, dim=-1)
        indices = [i for i in indices if i != self.blank]
        return "".join([self.labels[i] for i in indices])

    def decode(self, prediction):
        transcript = self(prediction)
        text = transcript.lower().replace("|", " ")
        return text
